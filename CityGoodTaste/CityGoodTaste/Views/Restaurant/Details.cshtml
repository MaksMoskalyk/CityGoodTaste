@model CityGoodTaste.Models.Restaurant

@{
    ViewBag.Title = "Restaurant";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@{
    string language = @CityGoodTaste.Controllers.HomeController.getCulture();
    string path = "../../../Scripts/Custom/Localization/datepicker-" + language + ".js";
    <script src=@path></script>
}

@*<link href="~/Content/icons/SchemaIcons/Table/style.css" rel="stylesheet" />
    <script src="~/Content/icons/SchemaIcons/Table/svgxuse.js"></script>

    <svg style="position: absolute; width: 0; height: 0; overflow: hidden" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <defs>
            <symbol id="icon-table" viewBox="0 0 32 32">
                <title>table</title>
                <path d="M1 10.875v1.125h6.675l-1.45 4.925c-0.8 2.725-1.475 5.025-1.475 5.125 0 0.125 1.1 0.2 2.45 0.2h2.425l0.75-2.625 0.725-2.625h9.55l0.725 2.625 0.75 2.625h2.425c1.35 0 2.45-0.075 2.45-0.2 0-0.1-0.65-2.375-1.45-5.050l-1.45-4.875 6.9-0.15v-2.225h-30v1.125zM30.5 10.875v0.625h-29v-1.25h29v0.625zM12 12.275c0 0.15-0.125 0.475-0.25 0.75-0.25 0.45-0.15 0.475 4.125 0.475s4.375-0.025 4.125-0.475c-0.5-0.95-0.325-1.050 1.65-0.975l1.9 0.075 1.45 4.8 1.425 4.825h-3.85l-0.8-2.7-0.825-2.675h-10.15l-0.825 2.675-0.8 2.7h-3.85l1.35-4.575c0.75-2.5 1.4-4.7 1.45-4.875 0.15-0.375 3.875-0.425 3.875-0.025zM19.325 12.5c0.125 0.475 0 0.5-3.45 0.5s-3.575-0.025-3.45-0.5c0.125-0.475 0.35-0.5 3.45-0.5s3.325 0.025 3.45 0.5z"></path>
            </symbol>
        </defs>
    </svg>

    <div class="form-group">
        <svg class="icon icon-table table"><use xlink:href="#icon-table"></use></svg>
    </div>*@


<div class="container-fluid NoPadding" style="margin-left: auto; margin-right: auto">
    <div class="col-sm-9">
        <div class="jumbotron" style="padding:0">
            <img class="img-responsive Center-Image-Width" src="https://placehold.it/800x400?text=IMAGE" alt="img" />
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div>
                    <span style="font-weight:bold">@CityGoodTaste.Resources.Resource.RestaurantName</span> 
                    @Html.DisplayFor(model => model.Name)
                </div>
                <div>
                    <span style="font-weight:bold">@CityGoodTaste.Resources.Resource.RestaurantAddress</span> 
                    @Html.DisplayFor(model => model.Address) @Html.DisplayFor(model => model.City.Name) @Html.DisplayFor(model => model.City.Country.Name)
                </div>
            </div>
            <div class="col-sm-4">
                <div>
                    <span style="font-weight:bold">@CityGoodTaste.Resources.Resource.Likes</span> 
                    <span class="badge">@Html.DisplayFor(model => model.Likes.Count)</span>
                </div>
                <div>
                    <span style="font-weight:bold">@CityGoodTaste.Resources.Resource.AverageCheck</span>
                    <span class="badge">@Html.DisplayFor(model => model.AverageCheck)</span>
                </div>
            </div>
        </div>
        <div>
            <div>
                <ul class="nav nav-tabs">
                    <li class="active"><a data-toggle="tab" href="#review">@CityGoodTaste.Resources.Resource.RestaurantReview</a></li>
                    <li><a data-toggle="tab" href="#menuRest">@CityGoodTaste.Resources.Resource.Menu</a></li>
                    <li><a data-toggle="tab" href="#notice">@CityGoodTaste.Resources.Resource.Events</a></li>
                    <li><a data-toggle="tab" href="#reviews">@CityGoodTaste.Resources.Resource.Reviews</a></li>
                </ul>

                <div class="tab-content">
                    <div id="review" class="tab-pane fade in active">
                        <div>
                            <h2><span style="font-weight:bold">@CityGoodTaste.Resources.Resource.InformationAboutRestaurant</span></h2>
                            <p>@Html.DisplayFor(model => model.InformationAbout)</p>
                        </div>
                        <div>
                            <h2><span style="font-weight:bold">@CityGoodTaste.Resources.Resource.RestaurantFeatures</span></h2>
                            <div class="row">
                                @for (int i = 0; i < Model.RestaurantFeatures.Count; i++)
                                {
                                    <div class="col-sm-4">@Model.RestaurantFeatures.ElementAt(i).Name</div>
                                }
                            </div>
                        </div>
                        <div>
                            <h2><span style="font-weight:bold">@CityGoodTaste.Resources.Resource.WorkHours</span></h2>
                            <table class="table table-responsive">
                                <thead>
                                    <tr>
                                        <th>@CityGoodTaste.Resources.Resource.Monday.ToUpper()</th>
                                        <th>@CityGoodTaste.Resources.Resource.Tuesday.ToUpper()</th>
                                        <th>@CityGoodTaste.Resources.Resource.Wednesday.ToUpper()</th>
                                        <th>@CityGoodTaste.Resources.Resource.Thursday.ToUpper()</th>
                                        <th>@CityGoodTaste.Resources.Resource.Friday.ToUpper()</th>
                                        <th>@CityGoodTaste.Resources.Resource.Saturday.ToUpper()</th>
                                        <th>@CityGoodTaste.Resources.Resource.Sunday.ToUpper()</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        @for (int i = 0; i < Model.WorkHours.Count; i++)
                                        {
                                            <th>@Model.WorkHours.ElementAt(i).OpenHour.Hours - @Model.WorkHours.ElementAt(i).CloseHour.Hours</th>
                                        }
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div>
                            <h2><span style="font-weight:bold">@CityGoodTaste.Resources.Resource.PhoneName</span></h2>
                            @Html.DisplayFor(model => model.PhoneNumber)
                        </div>
                        <div>
                            <h2><span style="font-weight:bold">@CityGoodTaste.Resources.Resource.RestaurantAddress</span></h2>
                            @Html.DisplayFor(model => model.Address) @Html.DisplayFor(model => model.City.Name) @Html.DisplayFor(model => model.City.Country.Name) @Html.DisplayFor(model => model.ZipCode)
                            <div id="googleMap" style="height:400px;width:100%"></div>
                            <script>
                                function myMap() {
                                    var myCenter = new google.maps.LatLng(46.477416, 30.746928);
                                    var mapProp = { center: myCenter, zoom: 18, scrollwheel: false, draggable: false, mapTypeId: google.maps.MapTypeId.ROADMAP };
                                    var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);
                                    var marker = new google.maps.Marker({ position: myCenter });
                                    marker.setMap(map);
                                }
                            </script>
                            <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDRO1uVeSSy5wTZOpDY0kGJR2347oaWJQ4&callback=myMap" async defer></script>
                        </div>
                        <br />
                    </div>
                    <div id="menuRest" class="tab-pane fade">
                        <ul class="nav nav-tabs">
                            @for (int i = 0; i < Model.Menu.Count; i++)
                            {
                                var SubMenu = Model.Menu.ToList()[i];
                                string isActive = "";
                                if (SubMenu == Model.Menu.First())
                                { isActive = "active"; }
                                string ShSubMenuID = "#SubMenu" + @i;
                                <li class=@isActive><a data-toggle="tab" href=@ShSubMenuID>@SubMenu.Name</a></li>
                            }
                        </ul>
                        <div class="tab-content">
                            @for (int i = 0; i < Model.Menu.Count; i++)
                            {
                                var SubMenu = Model.Menu.ToList()[i];
                                string isActiveM = "";
                                if (SubMenu == Model.Menu.First())
                                { isActiveM = "in active"; }
                                string SubMenuID = "SubMenu" + @i;

                                <div id=@SubMenuID class="tab-pane fade @isActiveM">
                                    <div class="panel-group" id="accordionMeal">
                                        @for (int j = 0; j < SubMenu.MealGroups.Count; j++)
                                        {
                                            var MealGroup = SubMenu.MealGroups.ToList()[j];
                                            <div class="panel panel-default">
                                                <div class="panel-heading">
                                                    <h4 class="panel-title">
                                                        @{
                                                            string colShID = "#collapseMealGroup" + @i + @j;
                                                        }
                                                        <a data-toggle="collapse" data-parent="#accordionMeal" href=@colShID>
                                                            <span>
                                                                @MealGroup.Name
                                                            </span>
                                                        </a>
                                                    </h4>
                                                </div>
                                                @{
                                                    
                                                    string colID = "collapseMealGroup" + @i + @j;
                                                }
                                                <div id=@colID class="panel-collapse collapse">
                                                    <div class="panel-bodycol-sm-12">
                                                        <div class="well">
                                                            <table class="table" >
                                                                @foreach (var Meal in MealGroup.Meals)
                                                                {
                                                                    <tr>
                                                                        <td style="width:110px">
                                                                            <img class="img-thumbnail" src="https://placehold.it/100x100?text=@Meal.Name" alt="Image">
                                                                        </td>
                                                                        <td style="text-align:left">
                                                                            <p style="font-size:large; margin:0;">@Meal.Name</p>
                                                                            <p>@Meal.Description</p>
                                                                        </td>
                                                                        <td style="width:100px">
                                                                            <p>@Meal.Price @Meal.Currency.sing</p>
                                                                        </td>
                                                                    </tr>
                                                                }
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                                    }
                                    </div>
                                </div>
}
                        </div>
                    </div>
                    <div id="notice" class="tab-pane fade">
                        <div class="panel-group" id="accordionEvent">
                            @for (int i = 0; i < @Model.RestaurantEvent.Count; i++)
                            {
                                var Event = @Model.RestaurantEvent.ToList()[i];
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <h4 class="panel-title">
                                            @{
                                                string colSID = "#collapseEvent" + @i;
                                            }
                                            <a data-toggle="collapse" data-parent="#accordionEvent" href=@colSID>
                                                <span>
                                                    @Event.Name
                                                </span>
                                                <span>
                                                    (@Event.StartDate
                                                    - @Event.EndDate)
                                                </span>
                                            </a>
                                        </h4>
                                    </div>
                                    @{
                                        string isActive = "";
                                        string colID = "collapseEvent" + @i;
                                    }
                                    @if (i == 0)
                                    {
                                        isActive = "in";
                                    }
                                    <div id=@colID class="panel-collapse collapse @isActive">
                                        <div class="panel-body">
                                            <img class="img-responsive Center-Image-Width" src="https://placehold.it/800x400?text=@Event.Name" alt="Image">
                                            <p class="WordBreak">
                                                @CityGoodTaste.Resources.Resource.EventTypes:
                                                @foreach (var EventType in @Event.EventTypes)
                                                {
                                                <span>@EventType.Icon</span>
                                                <span>@EventType.Name</span>
                                                    if (@EventType == @Event.EventTypes.Last())
                                                    {<span>.</span> }
                                                    else
                                                    {<span>, </span> }
                                                }
                                            </p>
                                            <p class="WordBreak">
                                                @CityGoodTaste.Resources.Resource.EventDescription: <br />
                                                @Event.Description
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                        }
                        </div>
                    </div>
                    <div id="reviews" class="tab-pane fade">
                        @foreach (var item in Model.Reviews)
                        {
                            <div class="row ">
                                <div class="col-sm-12">
                                    <div>
                                        <table style="border-spacing: 5px 5px; border-collapse:unset">
                                            <tr>
                                                <td class="well" style="border-radius:20px; padding:10px;">
                                                    <img src="https://placehold.it/90x90?text=Аватар" class="img-circle" width="90" height="90" alt="Avatar">
                                                    <br />
                                                    <h4 style="text-align:center">@item.User.Name</h4>
                                                </td>
                                                <td class="well" style="width:100%; border-radius:20px;padding:10px; vertical-align:top">
                                                    <p><span class="glyphicon glyphicon-time"> @item.Date.ToString()</span></p>
                                                    <p>@item.Text</p>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-sm-3 text-center">
        <div class="panel panel-default ">
            <div class="panel-heading">
                <p>@CityGoodTaste.Resources.Resource.MakeReserv</p>
            </div>

            <div class="panel-body text-center center-block">
                <p>@CityGoodTaste.Resources.Resource.Date</p>
                <div id="datepickerContainer" class="form-group center-block">
                    <div class="input-group">
                        <input type="text" id="datepicker" class="form-control">
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-calendar"></span>
                        </span>
            </div>
                </div>
            </div>

            <div class="panel-footer">
                <p>@CityGoodTaste.Resources.Resource.Time</p>
                <div class="form-group center-block">
                    <div class="input-group clockpicker ">
                        <input id="timePicker" type="text" class="form-control" value="09:30">
                        <span class="input-group-addon">
                            <span class="glyphicon glyphicon-time"></span>
                        </span>
                    </div>
                </div>
            </div>

            <div class="panel-body">
                <p>@CityGoodTaste.Resources.Resource.SelectTable</p>
                <div class="center-block row">
                    <a data-toggle="modal" data-target="#SchemaModal" href="#">
                        <img src="https://placehold.it/250x150?text=Schema" alt="img" class="img-responsive col-sm-12" />
                    </a>
                </div>
                <div id="reseredTables">@Html.Partial("_ReservedTablesPartial")</div>
            </div>

            <div class="panel-footer">
                <p>@CityGoodTaste.Resources.Resource.ContactInfo</p>
                <div class="form-group">
                    <div class="input-group col-sm-12">
                        <input id="name" type="text" class="form-control input-sm" name="name" placeholder="@CityGoodTaste.Resources.Resource.Name">
                    </div>
                </div>
                <div class="form-group">
                    <div class="input-group col-sm-12">
                        <input id="phone" type="text" class="form-control input-sm" name="phone" placeholder="@CityGoodTaste.Resources.Resource.PhoneName">
                </div>
                    </div>

                </div>
            <div class="panel-body">
                <div class="form-group">
                    <button id="reservBt" type="button" class="btn btn-success btn-block">@CityGoodTaste.Resources.Resource.Reserv</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal modal-lg fade" id="SchemaModal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        @Html.Action("SchemaReservedTables", "Restaurant", new { id = Model.Id })
    </div>
</div> 

<a style="visibility: hidden" id="confirmModalLink" data-toggle="modal" data-target="#ConfirmModal" href="#"></a>
<div class="modal fade" id="ConfirmModal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
@using (Ajax.BeginForm("ConfirmReserv", null, new AjaxOptions { UpdateTargetId = "reseredTables" }, new { id = "confirmForm" }))
{
        <div class="modal-content" style="width:400px">
            <div class="modal-header" style="background-color:#333333; color:white">             
                <span style="color:white">Подтвердить резерв</span>
                <button id="closeModalReserv" type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div id="confirmReservModalBody" class="modal-body" style="padding:40px 50px;">
            </div>
            <div class="modal-footer">
                <button id="sumbitReservBt" type="submit" class="btn btn-success btn-default pull-right">Подтвердить</button>
            </div>
        </div>
}
    </div>
</div> 

<a style="visibility: hidden" id="errorModalLink" data-toggle="modal" data-target="#errorModal" href="#"></a>
<div class="modal fade" id="errorModal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
            <div class="modal-content" style="width:200px">
                <div class="modal-header" style="background-color:#c34b4b; color:white">
                    <span style="color:white">Данные не заполнены</span>
                    <button id="closeModalError" type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div id="confirmReservModalBody" class="modal-body" style="padding:40px 50px;">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success btn-default pull-right" data-dismiss="modal">Ок</button>
                </div>
            </div>
    </div>
</div>

<a style="visibility: hidden" id="successModalLink" data-toggle="modal" data-target="#successModal" href="#"></a>
<div class="modal fade" id="successModal" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content" style="width:300px">
            <div class="modal-header" style="background-color:#333333; color:white">
                <span style="color:white">Бронь прошла успешно</span>
                <button id="closeModalSuccess" type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div id="confirmReservModalBody" class="modal-body" style="padding:40px 50px;">
                <p>Ваша бронь подтверждена, ждем вас.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success btn-default pull-right" data-dismiss="modal">Ок</button>
            </div>
        </div>
    </div>
</div>

<script>
    $('#reservBt').click(function () {
        var withProperty = [],
            els = document.getElementsByTagName('input'),
            i = 0,
            schemaId = -1,
            restId = @Model.Id,
            time = $('#timePicker').val(),
            date = $('#datepicker').val(),
            name = $('#name').val(),
            phone = $('#phone').val();
        var tablesCount=0;
        for (i = 0; i < els.length; i++) {
            if (els[i].hasAttribute('tableid')) {
                tablesCount++;
            }}

        if(name.length!=0&&phone.length!=0&&date.length!=0&&time.length!=0&&tablesCount>0){
            $('#confirmModalLink').click();

        }
        else{
            $('#errorModalLink').click();
            return;
        }

        $('#confirmReservModalBody').empty();
        $('#confirmReservModalBody').append("<p><span style=\"font-weight:bold\">Дата: </span>"+date+" "+time+"</p>");
        $('#confirmReservModalBody').append("<ul id=\"tablesUl\"><span style=\"font-weight:bold\">@CityGoodTaste.Resources.Resource.Tables:</span></ul>");
        for (i = 0; i < els.length; i++) {
            if (els[i].hasAttribute('tableid')) {

                $('#tablesUl').append("<li><input data-val=\"true\" name="+"tableId"+els[i].getAttribute('tableid')+
                    " type=\"hidden\" value="+els[i].getAttribute('tableid')+">"+"<div value="+1+">№ " + els[i].getAttribute('tableid') +
                    " (<span class=\"glyphicon glyphicon-user\">"+els[i].getAttribute('seats')+"</span>)</div>"+"</li>");

                withProperty.push(els[i]);
            }
            if (els[i].hasAttribute('schemaId') && schemaId==-1) {
                schemaId = els[i].getAttribute('schemaId');
            }
        }
        $('#confirmReservModalBody').append("<div><p><span style=\"font-weight:bold\">Имя: </span>"+name+"</p><p><span style=\"font-weight:bold\">Телефон: </span>"+phone+"</p></div>");
        $('#confirmForm').attr('action', '/Restaurant/ConfirmReserv?restId='+restId+'&schemaId=' + schemaId);
    });
</script>